<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocuMind - AI Document Intelligence</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzg4MmY2IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTE5IDIxSDVhMiAyIDAgMCAxLTItMlY1YTIgMiAwIDAgMSAyLTJoMTFsNSA1djExYTIgMiAwIDAgMS0yIDJ6Ij48L3BhdGg+PHBvbHlsaW5lIHBvaW50cz0iMTcgMjEgMTcgMTMgNyAxMyA3IDIxIj48L3BvbHlsaW5lPjxwb2x5bGluZSBwb2ludHM9IjcgMyA3IDggMTUgOCI+PC9wb2x5bGluZT48L3N2Zz4=">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.08) 0%, 
                rgba(255, 255, 255, 0.97) 25%,
                rgba(255, 255, 255, 0.97) 75%,
                rgba(147, 197, 253, 0.08) 100%);
            min-height: 100vh;
            display: flex;
            overflow: hidden; /* Prevent whole page scrolling */
            color: #334155;
            line-height: 1.6;
        }

        .sidebar {
            width: 350px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(59, 130, 246, 0.1);
            padding: 24px;
            overflow-y: auto;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.05);
            height: 100vh; /* Make sidebar full height */
            position: sticky;
            top: 0;
            z-index: 10;
            transition: all 0.3s ease;
        }
        
        .documents-list {
            max-height: calc(100vh - 300px); /* Adjust based on the upload section height */
            overflow-y: auto;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(59, 130, 246, 0.1);
            padding: 22px 32px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 5;
        }

        .header h1 {
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(135deg, #1e293b, #3b82f6, #1d4ed8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header h1::before {
            content: '';
            display: inline-block;
            width: 28px;
            height: 28px;
            background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzg4MmY2IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTE5IDIxSDVhMiAyIDAgMCAxLTItMlY1YTIgMiAwIDAgMSAyLTJoMTFsNSA1djExYTIgMiAwIDAgMS0yIDJ6Ij48L3BhdGg+PHBvbHlsaW5lIHBvaW50cz0iMTcgMjEgMTcgMTMgNyAxMyA3IDIxIj48L3BvbHlsaW5lPjxwb2x5bGluZSBwb2ludHM9IjcgMyA3IDggMTUgOCI+PC9wb2x5bGluZT48L3N2Zz4=");
            background-size: contain;
            background-repeat: no-repeat;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 24px 32px;
            background: rgba(255, 255, 255, 0.5);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px 0;
            max-height: calc(100vh - 200px);
            scroll-behavior: smooth;
        }

        .message {
            margin-bottom: 24px;
            display: flex;
            align-items: flex-start;
            gap: 14px;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .message.assistant .message-avatar {
            background: linear-gradient(135deg, #e0f2fe, #b3e5fc);
            color: #1e293b;
        }
        
        .message.user .message-avatar::before {
            content: '\f007';
            font-family: 'Font Awesome 6 Free';
        }
        
        .message.assistant .message-avatar::before {
            content: '\f544';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
        }

        .message-content {
            max-width: 70%;
            padding: 18px 22px;
            border-radius: 18px;
            line-height: 1.6;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border-bottom-right-radius: 4px;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2);
        }

        .message.assistant .message-content {
            background: rgba(255, 255, 255, 0.95);
            color: #1e293b;
            border: 1px solid rgba(59, 130, 246, 0.1);
            border-bottom-left-radius: 4px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .message-content h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1e293b;
            margin: 15px 0 10px 0;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            padding-bottom: 5px;
        }
        
        .message-content h4 {
            font-size: 1.05rem;
            font-weight: 600;
            color: #3b82f6;
            margin: 12px 0 8px 0;
        }
        
        .message-content ul {
            padding-left: 20px;
            margin: 8px 0;
        }
        
        .message-content li {
            margin-bottom: 6px;
            line-height: 1.5;
        }
        
        .no-info-found {
            background-color: #fff8f8;
            border-left: 3px solid #f87171;
            padding: 10px 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            color: #991b1b;
        }
        
        /* Removed low-confidence-warning class as requested */

        .sources {
            margin-top: 12px;
            padding: 12px;
            background: rgba(59, 130, 246, 0.05);
            border-radius: 12px;
            border-left: 3px solid #3b82f6;
        }

        .low-relevance-sources {
            background-color: rgba(251, 191, 36, 0.1);
            padding: 12px;
            border-radius: 12px;
            border-left: 3px solid rgba(251, 191, 36, 0.6);
        }

        .low-relevance-sources h4 {
            color: #92400e;
        }

        .sources h4 {
            font-size: 0.9rem;
            color: #3b82f6;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .source-item {
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 4px;
        }

        .low-relevance-sources .source-item {
            background-color: rgba(251, 191, 36, 0.05);
            border-left: 2px solid rgba(251, 191, 36, 0.4);
            padding: 6px 10px;
            border-radius: 4px;
        }

        .relevance-score {
            display: inline-block;
            font-size: 0.75rem;
            color: #92400e;
            margin-left: 5px;
            font-style: italic;
        }

        .input-container {
            display: flex;
            gap: 14px;
            padding: 24px 0;
            border-top: 1px solid rgba(59, 130, 246, 0.1);
            position: sticky;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            z-index: 5;
        }

        .message-input {
            flex: 1;
            padding: 16px 22px;
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
        }

        .message-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }

        .send-button {
            padding: 16px 24px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        
        .send-button::after {
            content: '\f061';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 0.9rem;
        }

        #arxivButton {
            display: none;
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .upload-section {
            margin-bottom: 32px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
        }

        .upload-section h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .upload-section h3 i {
            color: #3b82f6;
        }

        .file-upload {
            border: 2px dashed rgba(59, 130, 246, 0.3);
            border-radius: 14px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(59, 130, 246, 0.02);
        }

        .file-upload:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
            transform: translateY(-2px);
        }

        .file-upload.dragover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 2.2rem;
            color: #3b82f6;
            margin-bottom: 12px;
            display: inline-block;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-6px); }
            100% { transform: translateY(0px); }
        }

        .upload-text {
            color: #64748b;
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }

        .upload-button {
            margin-top: 15px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .upload-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .documents-list {
            margin-top: 20px;
        }

        .documents-list h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 15px;
        }

        .document-item {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(59, 130, 246, 0.1);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 14px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .document-item:hover {
            border-color: #3b82f6;
            box-shadow: 0 6px 18px rgba(59, 130, 246, 0.12);
            transform: translateY(-2px);
        }
        
        .document-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, #3b82f6, #60a5fa);
            opacity: 0.7;
        }

        .document-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .document-meta {
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 8px;
        }

        .document-actions {
            display: flex;
            gap: 8px;
        }

        .action-button {
            padding: 6px 12px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            background: rgba(59, 130, 246, 0.05);
            color: #3b82f6;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-button:hover {
            background: #3b82f6;
            color: white;
        }

        .delete-button {
            border-color: rgba(239, 68, 68, 0.3);
            background: rgba(239, 68, 68, 0.05);
            color: #ef4444;
        }

        .delete-button:hover {
            background: #ef4444;
            color: white;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Removed welcome-message styles as requested */
        
        .welcome-tips {
            margin-top: 20px;
            background-color: rgba(59, 130, 246, 0.05);
            border-radius: 12px;
            padding: 18px;
            text-align: left;
            border: 1px solid rgba(59, 130, 246, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
        }
        
        .arxiv-section {
            margin-bottom: 32px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
        }
        
        .arxiv-section h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .arxiv-section h3 i {
            color: #3b82f6;
        }
        
        .arxiv-search-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .arxiv-results {
            margin-top: 16px;
            max-height: 300px;
            overflow-y: auto;
            border-radius: 12px;
            padding-right: 6px;
        }
        
        .arxiv-paper {
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .arxiv-paper:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .arxiv-paper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, #3b82f6, #60a5fa);
            opacity: 0.5;
        }
        
        .arxiv-paper h4 {
            font-size: 14px;
            margin-bottom: 8px;
            color: #1e40af;
            padding-left: 10px;
            font-weight: 600;
        }
        
        .arxiv-paper-authors {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 8px;
            padding-left: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .arxiv-paper-authors::before {
            content: '\f007';
            font-family: 'Font Awesome 6 Free';
            color: #3b82f6;
            font-size: 10px;
        }
        
        .arxiv-paper-summary {
            font-size: 13px;
            color: #334155;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            padding-left: 10px;
            line-height: 1.5;
        }
        
        .arxiv-paper-links {
            display: flex;
            gap: 10px;
            padding-left: 10px;
        }
        
        .arxiv-paper-link {
            font-size: 12px;
            color: #3b82f6;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s ease;
        }
        
        .arxiv-paper-link:hover {
            color: #1d4ed8;
            transform: translateY(-1px);
        }
        
        .arxiv-paper-link::before {
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 10px;
        }
        
        .arxiv-paper-link.pdf::before {
            content: '\f1c1';
            color: #ef4444;
        }
        
        .arxiv-paper-link.abstract::before {
            content: '\f15c';
            color: #3b82f6;
        }
        
        .welcome-tips h4 {
            color: #2563eb;
            margin-bottom: 10px;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .welcome-tips ul {
            padding-left: 20px;
            margin-bottom: 0;
        }
        
        .welcome-tips li {
            margin-bottom: 8px;
            color: #4b5563;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        /* Notification styles removed */

        /* Custom scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(241, 245, 249, 0.8);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.5);
        }
        
        /* Welcome message styling */
        .welcome-message {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(241, 245, 249, 0.9));
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.05);
            margin-bottom: 24px;
            border: 1px solid rgba(59, 130, 246, 0.1);
            animation: fadeIn 0.6s ease-out;
        }
        
        .welcome-message h2 {
            color: #1e40af;
            font-size: 1.6rem;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .welcome-message p {
            color: #334155;
            font-size: 1.05rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                max-height: 300px;
            }
            
            .main-content {
                min-height: calc(100vh - 300px);
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="upload-section">
            <h3><i class="fas fa-file-upload"></i> Upload Documents</h3>
            <div class="file-upload" id="fileUpload">
                <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                <div class="upload-text">
                    Drag & drop PDF files here<br>
                    or click to select files
                </div>
                <input type="file" id="fileInput" class="file-input" multiple accept=".pdf">
            </div>
            <div style="text-align: center;">
                <button class="upload-button" id="uploadButton" disabled>
                    <i class="fas fa-upload"></i> Upload Documents
                </button>
            </div>
        </div>

        <div class="arxiv-section">
            <h3><i class="fas fa-search"></i> Arxiv Search</h3>
            <div class="arxiv-search-container">
                <input type="text" id="arxivSearchInput" class="message-input" placeholder="Search papers on Arxiv...">
                <div style="text-align: center;">
                    <button class="upload-button" id="arxivSearchButton" style="width: 50%;">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
            </div>
            <div id="arxivResults" class="arxiv-results"></div>
        </div>

        <div class="documents-section">
            <h3><i class="fas fa-book"></i> Uploaded Documents</h3>
            <div id="documentsList" class="documents-list">
                <!-- Welcome message removed as requested -->
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="header">
            <h1>DocuMind - AI Document Intelligence</h1>
        </div>

        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <div class="welcome-message">
                    <h2><i class="fas fa-robot"></i> Hello!</h2>
                    <p>I'm your AI assistant. Upload some documents and ask me anything about their content! You can also search for research papers on ArXiv using the search feature or by asking questions about scientific papers.</p>
                    <div class="welcome-tips">
                        <h4><i class="fas fa-lightbulb"></i> Tips:</h4>
                        <ul>
                            <li><i class="fas fa-file-pdf"></i> Upload up to 5 PDF documents</li>
                            <li><i class="fas fa-question-circle"></i> Ask specific questions about the content</li>
                            <li><i class="fas fa-star"></i> Look for the relevance score to gauge answer quality</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="input-container">
                <input type="text" class="message-input" id="messageInput" placeholder="Ask me anything about your documents...">
                <button class="send-button" id="sendButton">Send</button>
                <button class="send-button" id="arxivButton" title="Search ArXiv papers" style="display: none;">
                    <i class="fas fa-search"></i> ArXiv
                </button>
            </div>
        </div>
    </div>

    <script>
        // Arxiv search functionality
        document.addEventListener('DOMContentLoaded', function() {
            const arxivSearchInput = document.getElementById('arxivSearchInput');
            const arxivSearchButton = document.getElementById('arxivSearchButton');
            const arxivResults = document.getElementById('arxivResults');
            const arxivButton = document.getElementById('arxivButton');
            
            // Handle ArXiv button click in the chat interface
            arxivButton.addEventListener('click', function() {
                // Prompt the user for a search query
                const searchQuery = prompt('Enter your ArXiv search query:', '');
                if (!searchQuery || searchQuery.trim() === '') return;
                
                // Set the input field with a formatted ArXiv query
                document.getElementById('messageInput').value = `Find papers about ${searchQuery} on ArXiv`;
                
                // Send the message
                document.getElementById('sendButton').click();
            });
            
            arxivSearchButton.addEventListener('click', async function() {
                const query = arxivSearchInput.value.trim();
                if (!query) return;
                
                // Show loading state
                arxivResults.innerHTML = '<div class="loading">Searching Arxiv...</div>';
                
                try {
                    const response = await fetch('/arxiv/search', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            query: query,
                            max_results: 10
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (!data.success) {
                        arxivResults.innerHTML = `<div class="error">Error: ${data.error || 'Failed to search Arxiv'}</div>`;
                        return;
                    }
                    
                    if (data.papers.length === 0) {
                        arxivResults.innerHTML = '<div class="no-results">No papers found matching your query.</div>';
                        return;
                    }
                    
                    // Display results
                    arxivResults.innerHTML = '';
                    data.papers.forEach(paper => {
                        const paperElement = document.createElement('div');
                        paperElement.className = 'arxiv-paper';
                        
                        const authors = paper.authors.join(', ');
                        
                        paperElement.innerHTML = `
                            <h4>${paper.title}</h4>
                            <div class="arxiv-paper-authors">${authors}</div>
                            <div class="arxiv-paper-summary">${paper.summary}</div>
                            <div class="arxiv-paper-links">
                                <a href="${paper.html_link}" target="_blank" class="arxiv-paper-link">View on Arxiv</a>
                                <a href="${paper.pdf_link}" target="_blank" class="arxiv-paper-link">PDF</a>
                            </div>
                        `;
                        
                        arxivResults.appendChild(paperElement);
                    });
                    
                    // Add a message about the paper to the chat when clicked
                    const paperElements = document.querySelectorAll('.arxiv-paper');
                    paperElements.forEach((paperElement, index) => {
                        paperElement.addEventListener('click', function() {
                            const paper = data.papers[index];
                            const message = `Tell me about the paper "${paper.title}" by ${paper.authors.join(', ')}`;
                            document.getElementById('messageInput').value = message;
                        });
                    });
                    
                } catch (error) {
                    console.error('Error searching Arxiv:', error);
                    arxivResults.innerHTML = '<div class="error">Failed to search Arxiv. Please try again later.</div>';
                }
            });
            
            // Allow pressing Enter to search
            arxivSearchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    arxivSearchButton.click();
                }
            });
        });
        
        class DocuMindApp {
            constructor() {
                this.documents = [];
                this.selectedFiles = [];
                this.isLoading = false;
                
                this.initializeEventListeners();
                this.loadDocuments();
            }

            initializeEventListeners() {
                // File upload
                const fileUpload = document.getElementById('fileUpload');
                const fileInput = document.getElementById('fileInput');
                const uploadButton = document.getElementById('uploadButton');

                fileUpload.addEventListener('click', () => fileInput.click());
                fileUpload.addEventListener('dragover', this.handleDragOver.bind(this));
                fileUpload.addEventListener('dragleave', this.handleDragLeave.bind(this));
                fileUpload.addEventListener('drop', this.handleDrop.bind(this));
                
                fileInput.addEventListener('change', this.handleFileSelect.bind(this));
                uploadButton.addEventListener('click', this.uploadDocuments.bind(this));

                // Chat
                const messageInput = document.getElementById('messageInput');
                const sendButton = document.getElementById('sendButton');

                messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
                sendButton.addEventListener('click', this.sendMessage.bind(this));
            }

            handleDragOver(e) {
                e.preventDefault();
                e.currentTarget.classList.add('dragover');
            }

            handleDragLeave(e) {
                e.preventDefault();
                e.currentTarget.classList.remove('dragover');
            }

            handleDrop(e) {
                e.preventDefault();
                e.currentTarget.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files).filter(file => file.type === 'application/pdf');
                this.selectFiles(files);
            }

            handleFileSelect(e) {
                const files = Array.from(e.target.files).filter(file => file.type === 'application/pdf');
                this.selectFiles(files);
            }

            selectFiles(files) {
                if (files.length > 5) {
                    this.showError('Maximum 5 files allowed');
                    return;
                }

                this.selectedFiles = files;
                const uploadButton = document.getElementById('uploadButton');
                uploadButton.disabled = false;
                uploadButton.textContent = `Upload ${files.length} file(s)`;
            }

            async uploadDocuments() {
                if (this.selectedFiles.length === 0) return;

                const uploadButton = document.getElementById('uploadButton');
                uploadButton.disabled = true;
                uploadButton.innerHTML = '<div class="loading"></div> Uploading...';

                const formData = new FormData();
                this.selectedFiles.forEach(file => {
                    formData.append('files', file);
                });

                try {
                    const response = await fetch('/upload', {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    if (response.ok) {
                        this.showSuccess(`Successfully uploaded ${result.documents.length} document(s)`);
                        this.loadDocuments();
                        this.selectedFiles = [];
                        document.getElementById('fileInput').value = '';
                        uploadButton.textContent = 'Upload Documents';
                        uploadButton.disabled = true;
                    } else {
                        this.showError(result.detail || 'Upload failed');
                    }
                } catch (error) {
                    this.showError('Upload failed: ' + error.message);
                } finally {
                    uploadButton.disabled = false;
                }
            }

            async loadDocuments() {
                try {
                    const response = await fetch('/documents');
                    const result = await response.json();
                    this.documents = result.documents;
                    this.renderDocuments();
                } catch (error) {
                    console.error('Error loading documents:', error);
                }
            }

            renderDocuments() {
                const documentsList = document.getElementById('documentsList');
                
                if (this.documents.length === 0) {
                    documentsList.innerHTML = ''; // Removed welcome message as requested
                    return;
                }

                documentsList.innerHTML = this.documents.map(doc => `
                    <div class="document-item">
                        <div class="document-title">${doc.title}</div>
                        <div class="document-meta">
                            ${doc.filename} • ${doc.page_count} pages • ${doc.sections.length} sections
                        </div>
                        <div class="document-actions">
                            <button class="action-button" onclick="app.summarizeDocument('${doc.file_id}')">Summarize</button>
                            <button class="action-button delete-button" onclick="app.deleteDocument('${doc.file_id}')">Delete</button>
                        </div>
                    </div>
                `).join('');
            }

            async deleteDocument(fileId) {
                if (!confirm('Are you sure you want to delete this document?')) return;

                try {
                    const response = await fetch(`/documents/${fileId}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        this.showSuccess('Document deleted successfully');
                        this.loadDocuments();
                    } else {
                        const result = await response.json();
                        this.showError(result.detail || 'Delete failed');
                    }
                } catch (error) {
                    this.showError('Delete failed: ' + error.message);
                }
            }

            async summarizeDocument(fileId) {
                const doc = this.documents.find(d => d.file_id === fileId);
                if (!doc) return;

                this.addMessage('user', `Summarize the document: ${doc.title}`);
                
                try {
                    const response = await fetch('/query', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            query: `Please provide a comprehensive summary of the document "${doc.title}". Include the main topic, key findings, methodology, and conclusions.`,
                            document_ids: [fileId]
                        })
                    });

                    const result = await response.json();
                    
                    if (response.ok) {
                        this.addMessage('assistant', result.answer, result.sources);
                    } else {
                        this.addMessage('assistant', 'Sorry, I couldn\'t generate a summary at this time.');
                    }
                } catch (error) {
                    this.addMessage('assistant', 'Error generating summary: ' + error.message);
                }
            }

            async sendMessage() {
                const messageInput = document.getElementById('messageInput');
                const message = messageInput.value.trim();
                
                if (!message) return;

                this.addMessage('user', message);
                messageInput.value = '';

                const sendButton = document.getElementById('sendButton');
                sendButton.disabled = true;
                sendButton.innerHTML = '<div class="loading"></div>';

                try {
                    const response = await fetch('/query', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            query: message
                        })
                    });

                    const result = await response.json();
                    
                    if (response.ok) {
                        // Removed confidence indicator as requested
                        this.addMessage('assistant', result.answer, result.sources);
                    } else {
                        this.addMessage('assistant', 'Sorry, I couldn\'t process your request at this time.');
                    }
                } catch (error) {
                    this.addMessage('assistant', 'Error: ' + error.message);
                } finally {
                    sendButton.disabled = false;
                    sendButton.textContent = 'Send';
                }
            }

            addMessage(role, content, sources = null) {
                const chatMessages = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${role}`;

                const avatar = role === 'user' ? 'U' : 'AI';
                let sourcesHtml = '';
                if (sources && sources.length > 0) {
                    // Check if all sources have low relevance scores (below 0.3)
                    const allLowRelevance = sources.every(source => source.relevance_score < 0.3);
                    
                    sourcesHtml = `
                        <div class="sources ${allLowRelevance ? 'low-relevance-sources' : ''}">
                            <h4>Sources${allLowRelevance ? ' (Low Relevance)' : ''}:</h4>
                            ${sources.map(source => {
                                // Check if it's an ArXiv source
                                if (source.arxiv_id) {
                                    return `
                                        <div class="source-item">
                                            <strong>${source.filename}</strong><br>
                                            <a href="${source.html_link}" target="_blank">View on ArXiv</a> | 
                                            <a href="${source.pdf_link}" target="_blank">Download PDF</a>
                                            ${allLowRelevance ? `<span class="relevance-score">(Relevance: ${(source.relevance_score * 100).toFixed(1)}%)</span>` : ''}
                                        </div>
                                    `;
                                } else {
                                    return `
                                        <div class="source-item">
                                            ${source.filename} - ${source.section_title} (Page ${source.page_number})
                                            ${allLowRelevance ? `<span class="relevance-score">(Relevance: ${(source.relevance_score * 100).toFixed(1)}%)</span>` : ''}
                                        </div>
                                    `;
                                }
                            }).join('')}
                        </div>
                    `;
                }
                
                // Format content with proper headings and bullet points if it's from the assistant
                let formattedContent = content;
                if (role === 'assistant') {
                    // Check if the response indicates no information was found
                    if (formattedContent.includes("I am sorry") || 
                        formattedContent.includes("I couldn't find") || 
                        formattedContent.includes("No information") || 
                        formattedContent.includes("not available") ||
                        formattedContent.includes("does not contain")) {
                        formattedContent = `<div class="no-info-found"><strong>No Information Found:</strong> ${formattedContent}</div>`;
                    }
                    
                    // Replace headings with proper HTML heading tags
                    formattedContent = formattedContent.replace(/\*\*(.*?):\*\*/g, '<h3>$1</h3>');
                    
                    // Format bullet points with proper HTML list elements
                    formattedContent = formattedContent.replace(/\* \*\*(.*?):\*\*/g, '<h4>$1</h4>');
                    formattedContent = formattedContent.replace(/\* (.*?)(?=\n|$)/g, '<li>$1</li>');
                    
                    // Wrap lists in <ul> tags
                    if (formattedContent.includes('<li>')) {
                        formattedContent = formattedContent.replace(/(<li>.*?<\/li>\n*)+/g, '<ul>$&</ul>');
                    }
                }

                messageDiv.innerHTML = `
                    <div class="message-avatar">${avatar}</div>
                    <div class="message-content">
                        ${formattedContent}
                        ${sourcesHtml}
                    </div>
                `;

                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            // Notification functions replaced with console.log
            showError(message) {
                console.error('Error:', message);
            }

            showSuccess(message) {
                console.log('Success:', message);
            }
        }

        // Initialize the app
        const app = new DocuMindApp();
    </script>
</body>
</html>
